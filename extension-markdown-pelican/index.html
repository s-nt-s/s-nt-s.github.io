<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<title>Crear extensión markdown para usar en pelican</title>
<link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180"/>
<link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png"/>
<link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png"/>
<link href="/site.webmanifest" rel="manifest"/>
<link color="#5bbad5" href="/safari-pinned-tab.svg" rel="mask-icon"/>
<meta content="#da532c" name="msapplication-TileColor"/>
<meta content="#ffffff" name="theme-color"/>
<link href="/theme/css/main.css" rel="stylesheet"/>
<link href="/feeds/all.atom.xml" rel="alternate" title="Apuntes Atom Feed" type="application/atom+xml"/>
</head>
<body class="home" id="index">
<header class="body" id="banner">
<h1 class="entry-title"><a href="/extension-markdown-pelican" rel="bookmark" title="Permalink to Crear extensión markdown para usar en pelican">Crear extensión markdown para usar en pelican</a></h1><div class="post-info">
<p>
<time class="published" datetime="2018-09-22T00:00:00+02:00" title="Publicado el 2018-09-22">2018-09-22</time>
<a class="bubble category ct_web" href="/category/web.html" title="Hay 5 entradas más sobre Web">
Web</a>
<a class="bubble tag tg_markdown" href="/tag/markdown.html" title="Hay 2 entradas  más sobre markdown">
markdown</a> <a class="bubble tag tg_pelican" href="/tag/pelican.html" title="Hay 2 entradas  más sobre pelican">
pelican</a> <a class="bubble tag tg_python" href="/tag/python.html" title="Hay 5 entradas  más sobre python">
python</a> </p>
<p>
<span class="bubble">115 lineas</span> <span class="bubble wc">676 palabras</span> <span class="bubble wc">5.623 letras</span>
</p>
</div><!-- /.post-info --> </header><!-- /#banner -->
<section class="body" id="content">
<article>
<div class="entry-content">
<p>Según la documentación de <code>pelican</code> la manera de incluir un plugin <code>markdown</code>
es poniendo en <code>pelicanconf.py</code> lo siguiente:</p>
<div class="highlight"><pre><span></span><code><span class="n">MARKDOWN</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'extensions'</span><span class="p">:</span> <span class="p">[</span> <span class="o">&lt;&lt;</span><span class="n">aquí</span> <span class="n">van</span> <span class="n">las</span> <span class="n">extensiones</span><span class="o">&gt;&gt;</span> <span class="p">],</span>
    <span class="s1">'extension_configs'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'markdown.extensions.codehilite'</span><span class="p">:</span> <span class="p">{</span><span class="s1">'css_class'</span><span class="p">:</span> <span class="s1">'highlight'</span><span class="p">},</span>
        <span class="s1">'markdown.extensions.extra'</span><span class="p">:</span> <span class="p">{},</span>
        <span class="s1">'markdown.extensions.meta'</span><span class="p">:</span> <span class="p">{},</span>
    <span class="p">},</span>
    <span class="s1">'output_format'</span><span class="p">:</span> <span class="s1">'html5'</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>
<p>donde la parte relevante es el array <code>extensions</code> ya que lo demás solo se pone
para preservar el valor por defecto de la variable <code>MARKDOWN</code></p>
<p>Si estamos incluyendo extensiones de terceros probablemente esto sea lo mejor,
pero si la extensión la estamos haciendo nosotros puede que queramos evitarnos
tener que escribir este bloque y así mantener más limpio nuestro fichero
<code>pelicanconf.py</code> y de este modo solo pensar en <code>plugins</code> en general, sin hacer
distinción si son <code>plugins de pelican</code> o <code>extensiones de markdown</code>.</p>
<p>En definitiva, la idea es es crear la extensión dentro de un plugin.
Esto también es útil cuando queremos configurar la extensión en base a
variables de <code>pelicanconf.py</code> evitando tener que pasarlas por parámetro una a una.</p>
<p>Este sería un ejemplo para poder usar variables en <code>markdown</code></p>
<p>En <code>pelicanconf.py</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">os</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)</span> <span class="c1">#### 1</span>
<span class="kn">from</span> <span class="nn">plugins</span> <span class="kn">import</span> <span class="n">replacements</span> <span class="c1">#### 2</span>

<span class="n">abspath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
<span class="n">cur_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">abspath</span><span class="p">)</span>

<span class="n">REPLACEMENTS_CONFIG</span> <span class="o">=</span> <span class="n">cur_dir</span><span class="o">+</span><span class="s2">"/config/replacements.yml"</span> <span class="c1">#### 3</span>
<span class="n">PLUGINS</span><span class="o">=</span><span class="p">[</span><span class="n">replacements</span><span class="p">]</span> <span class="c1">#### 4</span>

<span class="n">GITHUB_URL</span> <span class="o">=</span> <span class="s1">'https://github.com/s-nt-s/s-nt-s.github.io'</span>
<span class="n">DEFAULT_PAGINATION</span> <span class="o">=</span> <span class="mi">10</span>
</code></pre></div>
<ul>
<li>Con <code>1</code> y <code>2</code> incluimos el <code>plugin</code> que esta en <code>plugins/replacements.py</code></li>
<li>Con <code>3</code> definimos la variable que se usara para obtener el fichero de configuración</li>
<li>Con <code>4</code> incluimos el <code>plugin</code></li>
</ul>
<p>En <code>plugins/replacements.py</code> tenemos:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">markdown.preprocessors</span> <span class="kn">import</span> <span class="n">Preprocessor</span>
<span class="kn">from</span> <span class="nn">markdown.extensions</span> <span class="kn">import</span> <span class="n">Extension</span>
<span class="kn">from</span> <span class="nn">pelican</span> <span class="kn">import</span> <span class="n">signals</span>
<span class="kn">import</span> <span class="nn">yaml</span>

<span class="k">class</span> <span class="nc">MkReplace</span><span class="p">(</span><span class="n">Preprocessor</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">,</span> <span class="n">replacements</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replacements</span> <span class="o">=</span> <span class="n">replacements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delimiter</span> <span class="o">=</span> <span class="n">delimiter</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">replacements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delimiter</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">delimiter</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ExReplace</span><span class="p">(</span><span class="n">Extension</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">,</span> <span class="n">replacements</span><span class="p">,</span> <span class="o">**</span><span class="n">config</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replacements</span> <span class="o">=</span> <span class="n">replacements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delimiter</span> <span class="o">=</span> <span class="n">delimiter</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ExReplace</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">config</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">extendMarkdown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">md</span><span class="p">,</span> <span class="n">md_globals</span><span class="p">):</span>
        <span class="n">md</span><span class="o">.</span><span class="n">preprocessors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">'replacements'</span><span class="p">,</span> <span class="n">MkReplace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delimiter</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">replacements</span><span class="p">),</span> <span class="s2">"&gt;html_block"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">process_settings</span><span class="p">(</span><span class="n">pelican_object</span><span class="p">):</span>
    <span class="n">config_file</span> <span class="o">=</span> <span class="n">pelican_object</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'REPLACEMENTS_CONFIG'</span><span class="p">]</span> <span class="c1">#### 1</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
        <span class="n">replacements</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">'PELICAN_SETTINGS'</span> <span class="ow">in</span> <span class="n">replacements</span><span class="p">:</span>
        <span class="n">pSettings</span> <span class="o">=</span> <span class="n">replacements</span><span class="p">[</span><span class="s1">'PELICAN_SETTINGS'</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">replacements</span><span class="p">[</span><span class="s1">'PELICAN_SETTINGS'</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pSettings</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">pSettings</span> <span class="o">=</span> <span class="n">pSettings</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pSettings</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">pSettings</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">replacements</span> <span class="ow">and</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">pelican_object</span><span class="o">.</span><span class="n">settings</span><span class="p">:</span>
                    <span class="n">replacements</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">pelican_object</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="n">s</span><span class="p">])</span> <span class="c1">#### 2</span>
    <span class="n">delimiter</span> <span class="o">=</span> <span class="n">replacements</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">'DELIMITER'</span><span class="p">,</span> <span class="s1">'::'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">delimiter</span><span class="p">,</span> <span class="n">replacements</span>

<span class="k">def</span> <span class="nf">replacements_markdown_extension</span><span class="p">(</span><span class="n">pelicanobj</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">,</span> <span class="n">replacements</span><span class="p">):</span>
    <span class="sd">"""Instantiates a customized Markdown extension"""</span>
    <span class="n">pelicanobj</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">'MARKDOWN'</span><span class="p">]</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">'extensions'</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ExReplace</span><span class="p">(</span><span class="n">delimiter</span><span class="p">,</span> <span class="n">replacements</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">replacements_init</span><span class="p">(</span><span class="n">pelicanobj</span><span class="p">):</span>
    <span class="sd">"""Loads settings and instantiates the Python Markdown extension"""</span>
    <span class="c1"># Process settings</span>
    <span class="n">delimiter</span><span class="p">,</span> <span class="n">replacements</span> <span class="o">=</span> <span class="n">process_settings</span><span class="p">(</span><span class="n">pelicanobj</span><span class="p">)</span>

    <span class="c1"># Configure Markdown Extension</span>
    <span class="n">replacements_markdown_extension</span><span class="p">(</span><span class="n">pelicanobj</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">,</span> <span class="n">replacements</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">register</span><span class="p">():</span>
    <span class="sd">"""Plugin registration"""</span>
    <span class="n">signals</span><span class="o">.</span><span class="n">initialized</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">replacements_init</span><span class="p">)</span>
</code></pre></div>
<ul>
<li><code>register</code> registra el <code>plugin</code></li>
<li><code>replacements_init</code> usa <code>pelicanobj</code> para preparar las opciones a través de <code>process_settings</code> y pasarselas a <code>replacements_markdown_extension</code></li>
<li><code>replacements_markdown_extension</code> include la extensión de <code>markdown</code> en el <code>pelican</code> sin machacar los valores por defecto de la variable <code>MARKDOWN</code></li>
<li>El resto es el contenido habitual de una extensión <code>markdown</code></li>
</ul>
<p>En <code>process_settings</code> vemos como nos es de ayuda tener el objeto <code>pelican</code> disponible,
de manera que tenemos disponible <code>REPLACEMENTS_CONFIG</code> para encontrar el <code>yaml</code> de configuración (en <code>1</code>)
y a su vez podemos usar otras variables (en <code>2</code>) de manera que si el <code>yaml</code> es:</p>
<div class="highlight"><pre><span></span><code><span class="c">DELIMITER: '::'</span>
<span class="c">PELICAN_SETTINGS: GITHUB_URL DEFAULT_PAGINATION</span>
<span class="c">LOREM: Neque porro quisquam est qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit...</span>
</code></pre></div>
<p>y tenemos un <code>markdown</code> tal que así:</p>
<div class="highlight"><pre><span></span><code><span class="n">Este</span><span class="w"> </span><span class="n">blog</span><span class="w"> </span><span class="n">usa</span><span class="w"> </span><span class="n">una</span><span class="w"> </span><span class="n">imaginación</span><span class="w"> </span><span class="n">de</span><span class="w"> </span><span class="o">**::</span><span class="nl">DEFAULT_PAGINATION</span><span class="p">:</span><span class="err">:</span><span class="o">**</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="n">por</span><span class="w"> </span><span class="n">hoja</span><span class="w"> </span><span class="n">y</span><span class="w"></span>
<span class="n">puedes</span><span class="w"> </span><span class="n">encontrar</span><span class="w"> </span><span class="n">el</span><span class="w"> </span><span class="n">código</span><span class="w"> </span><span class="n">en</span><span class="w"> </span><span class="o">[</span><span class="n">github</span><span class="o">]</span><span class="p">(</span><span class="o">::</span><span class="nl">GITHUB_URL</span><span class="p">:</span><span class="err">:</span><span class="p">)</span><span class="w"></span>

<span class="o">::</span><span class="nl">LOREN</span><span class="p">:</span><span class="err">:</span><span class="w"></span>
</code></pre></div>
<p>se transformara justo antes de ser pasado a <code>html</code> en:</p>
<div class="highlight"><pre><span></span><code><span class="n">Este</span><span class="w"> </span><span class="n">blog</span><span class="w"> </span><span class="n">usa</span><span class="w"> </span><span class="n">una</span><span class="w"> </span><span class="n">imaginación</span><span class="w"> </span><span class="n">de</span><span class="w"> </span><span class="o">**</span><span class="mi">10</span><span class="o">**</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="n">por</span><span class="w"> </span><span class="n">hoja</span><span class="w"> </span><span class="n">y</span><span class="w"></span>
<span class="n">puedes</span><span class="w"> </span><span class="n">encontrar</span><span class="w"> </span><span class="n">el</span><span class="w"> </span><span class="n">código</span><span class="w"> </span><span class="n">en</span><span class="w"> </span><span class="o">[</span><span class="n">github</span><span class="o">]</span><span class="p">(</span><span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">s</span><span class="o">-</span><span class="n">nt</span><span class="o">-</span><span class="n">s</span><span class="o">/</span><span class="n">s</span><span class="o">-</span><span class="n">nt</span><span class="o">-</span><span class="n">s</span><span class="p">.</span><span class="n">github</span><span class="p">.</span><span class="n">io</span><span class="p">)</span><span class="w"></span>

<span class="n">Neque</span><span class="w"> </span><span class="n">porro</span><span class="w"> </span><span class="n">quisquam</span><span class="w"> </span><span class="n">est</span><span class="w"> </span><span class="n">qui</span><span class="w"> </span><span class="n">dolorem</span><span class="w"> </span><span class="n">ipsum</span><span class="w"> </span><span class="n">quia</span><span class="w"> </span><span class="n">dolor</span><span class="w"> </span><span class="n">sit</span><span class="w"> </span><span class="n">amet</span><span class="p">,</span><span class="w"> </span><span class="n">consectetur</span><span class="p">,</span><span class="w"> </span><span class="n">adipisci</span><span class="w"> </span><span class="n">velit</span><span class="p">...</span><span class="w"></span>
</code></pre></div>
<p>y finalmente en el <code>html</code></p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Este blog usa una imaginación de <span class="p">&lt;</span><span class="nt">b</span><span class="p">&gt;</span>10<span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;</span> items por hoja y
puedes encontrar el código en <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">'https://github.com/s-nt-s/s-nt-s.github.io'</span><span class="p">&gt;</span>github<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Neque porro quisquam est qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit...<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</code></pre></div>
<p>Resumo las ventajas:</p>
<ul>
<li>menos lineas en <code>pelicanconf.py</code></li>
<li>no hay peligro de machacar valores por defecto de <code>MARKDOWN</code> necesarios</li>
<li>la extensión tiene acceso al objeto <code>pelican</code> y por lo tanto a sus variables de configuración</li>
<li>la extensión es más fácil de configurar</li>
<li>no hace falta diferencia entre <code>extensiones markdown</code> y <code>plugins pelican</code></li>
</ul>
<p>Fuentes:
<a href="http://docs.getpelican.com/en/stable/settings.html#settings" target="_blank">docs.getpelican.com - settings</a>,
<a href="http://docs.getpelican.com/en/stable/plugins.html#how-to-create-plugins" target="_blank">docs.getpelican.com - plugins</a>,
<a href="https://github.com/s-nt-s/s-nt-s.github.io" target="_blank">mi github :P</a></p>
</div><!-- /.entry-content -->
</article>
</section>
<footer class="body" id="extras">
<div class="menu">
<h2>Menú</h2>
<nav>
<ul>
<li>
<strong><a href="/">INICIO</a></strong>
</li>
<li><a href="/p/about">About</a></li>
<li><a href="/mapa">Mapa</a></li>
<li><a href="https://github.com/s-nt-s/s-nt-s.github.io/tree/main" target="_blank">Ver Github</a></li>
<li><a href="https://github.com/s-nt-s/s-nt-s.github.io/tree/main/themes/notmyidea-custom/templates/article.html" target="_blank">Ver Template</a></li>
<li><a href="https://github.com/s-nt-s/s-nt-s.github.io/tree/main/content/posts/2018-09-22_extension-markdown-pelican.md" target="_blank">Ver Markdown</a></li>
</ul>
<ul>
<li><a href="https://validator.w3.org/check?charset=(detect+automatically)&amp;doctype=Inline&amp;group=1&amp;uri=https://s-nt-s.github.io/extension-markdown-pelican" target="_blank">Validar HTML</a></li>
</ul>
</nav>
</div><!-- /.menu -->
<div class="social">
<h2>Social</h2>
<ul>
<li><a href="/feeds/all.atom.xml" rel="alternate" type="application/atom+xml">atom feed</a></li>
<li><a href="https://github.com/s-nt-s/" target="_blank">@s-nt-s</a></li>
<li><a href="xmpp:git@suchat.org">git@suchat.org</a></li>
</ul>
</div><!-- /.social -->
<div class="license">
<p><a class="logo" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.es" rel="license" target="_blank"><img alt="Licencia Creative Commons" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"/></a> Esta obra está bajo una <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.es" rel="license" target="_blank">Licencia Creative Commons Atribución-NoComercial-CompartirIgual 4.0 Internacional</a>.</p>
</div>
</footer><!-- /#extras -->
</body>
</html>