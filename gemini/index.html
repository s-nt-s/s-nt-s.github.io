<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<title>Servidor Gemini en Raspberry</title>
<link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180"/>
<link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png"/>
<link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png"/>
<link href="/site.webmanifest" rel="manifest"/>
<link color="#5bbad5" href="/safari-pinned-tab.svg" rel="mask-icon"/>
<meta content="#da532c" name="msapplication-TileColor"/>
<meta content="#ffffff" name="theme-color"/>
<link href="/theme/css/main.css" rel="stylesheet"/>
<link href="/feeds/all.atom.xml" rel="alternate" title="Apuntes Atom Feed" type="application/atom+xml"/>
</head>
<body class="home" id="index">
<header class="body" id="banner">
<h1 class="entry-title"><a href="/gemini" rel="bookmark" title="Permalink to Servidor Gemini en Raspberry">Servidor Gemini en Raspberry</a></h1><div class="post-info">
<p>
<time class="published" datetime="2023-02-26T00:00:00+01:00" title="Publicado el 2023-02-26">2023-02-26</time>
<a class="bubble category ct_web" href="/category/web.html" title="Hay 6 entradas más sobre Web">
Web</a>
<a class="bubble tag tg_raspberrypi" href="/tag/raspberry-pi.html" title="Hay 10 entradas  más sobre Raspberry Pi">
Raspberry Pi</a> <span class="bubble tag tg_gemini" title="No hay más entradas con esta etiqueta">gemini</span> <a class="bubble tag tg_linux" href="/tag/linux.html" title="Hay 19 entradas  más sobre linux">
linux</a> </p>
<p>
<span class="bubble">64 lineas</span> <span class="bubble wc">312 palabras</span> <span class="bubble wc">2.642 letras</span>
</p>
</div><!-- /.post-info --> </header><!-- /#banner -->
<section class="body" id="content">
<article>
<div class="entry-content">
<p>Este método ha sido probado en una Raspberry Pi 3</p>
<h2>Estructura de carpetas</h2>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span><span class="nv">GEMINI_DOMAIN</span><span class="o">=</span>replace.by.your.domain.com
<span class="gp">$ </span>mkdir -p ~/gemini/<span class="nv">$GEMINI_DOMAIN</span>
<span class="gp">$ </span><span class="nb">echo</span> <span class="s2">"Hola mundo"</span> &gt; ~/gemini/<span class="nv">$GEMINI_DOMAIN</span>/index.gmi
</code></pre></div>
<h2>Descargar <code>agate</code> y crear script de arranque</h2>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span><span class="nb">cd</span> ~/gemini
<span class="gp">$ </span>wget -O - <span class="k">$(</span>curl -s https://api.github.com/repos/mbrubeck/agate/releases/latest <span class="p">|</span> grep <span class="s2">"browser_download_url.*agate.armv7-unknown-linux.*.gz"</span> <span class="p">|</span> cut -d<span class="s1">'"'</span> -f4<span class="k">)</span> <span class="p">|</span> gunzip &gt; agate-server.bin
<span class="gp">$ </span>cat &gt; agate-server.sh &lt;&lt;EOL
<span class="gp">#</span>!/bin/sh
<span class="go">set -e</span>
<span class="go">cd "\$(dirname "\$0")"</span>

<span class="go">INX=\$(find . -maxdepth 2 -type f -name index.gmi | sort | head -n 1)</span>
<span class="go">if [ ! -f \$INX ]; then</span>
<span class="go">    echo "index.gmi not found"</span>
<span class="go">    exit 1</span>
<span class="go">fi</span>
<span class="go">DOM=\$(echo "\$INX" | xargs dirname | xargs | xargs basename)</span>
<span class="go">./agate-server.bin --lang es-ES --certs ./certificate/ --content "./\$DOM/" --hostname "\$DOM"</span>
<span class="go">EOL</span>
<span class="gp">$ </span>chmod +x agate-server.bin agate-server.sh
<span class="gp">$ </span>./agate-server.bin --version
<span class="go">agate 3.2.4</span>
</code></pre></div>
<p><strong>NOTA</strong>: el script <code>agate-server.sh</code> permite usar como dominio
el nombre del directorio que tiene el contenido, así si queremos
cambiarlo basta con renombrar la carpeta y no hay que editar el
servicio <code>agate.service</code> creado más adelante.</p>
<h2>Crear servicio</h2>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span>cat &gt; agate.service &lt;&lt;EOL
<span class="go">[Unit]</span>
<span class="go">Description=Agate gemini server</span>
<span class="go">After=network.target</span>

<span class="go">[Service]</span>
<span class="go">WorkingDirectory=${HOME}/gemini</span>
<span class="go">ExecStart=${HOME}/gemini/agate-server.sh</span>

<span class="go">Restart=always</span>
<span class="go">RestartSec=1</span>

<span class="go">StandardOutput=syslog</span>
<span class="go">StandardError=syslog</span>
<span class="go">SyslogIdentifier=gemini</span>

<span class="go">[Install]</span>
<span class="go">WantedBy=multi-user.target</span>
<span class="go">EOL</span>
<span class="gp">$ </span>sudo mv agate.service /etc/systemd/system/agate.service
<span class="gp">$ </span>sudo systemctl <span class="nb">enable</span> agate
<span class="gp">$ </span>sudo systemctl start agate
<span class="gp">$ </span>sudo systemctl status agate
<span class="go">● agate.service - Agate gemini server</span>
<span class="go">   Loaded: loaded (/etc/systemd/system/agate.service; enabled; vendor preset: enabled)</span>
<span class="go">   Active: active (running) since Sun 2023-02-26 11:22:24 CET; 4s ago</span>
<span class="go"> Main PID: 9914 (agate-server.sh)</span>
<span class="go">    Tasks: 6 (limit: 4915)</span>
<span class="go">   Memory: 1.0M</span>
<span class="go">      CPU: 68ms</span>
<span class="go">   CGroup: /system.slice/agate.service</span>
<span class="go">           ├─9914 /bin/sh /home/pi/gemini/agate-server.sh</span>
<span class="go">           └─9931 ./agate-server.bin --lang es-ES --certs ./certificate/ --content ./replace.by.your.domain.com/ --hostname replace.by.your.domain.com</span>

<span class="go">feb 26 11:22:24 bot systemd[1]: Started Agate gemini server.</span>
<span class="go">feb 26 11:22:24 bot gemini[9914]: [2023-02-26T10:22:24Z INFO  agate] The certificate directory "./certificate/" does not exist, creating it.</span>
<span class="go">feb 26 11:22:24 bot gemini[9914]: [2023-02-26T10:22:24Z INFO  agate] No certificate or key found for "replace.by.your.domain.com", generating them.</span>
<span class="go">feb 26 11:22:24 bot gemini[9914]: [2023-02-26T10:22:24Z INFO  agate] Started listener on [::]:1965</span>
</code></pre></div>
<h2>Clientes</h2>
<p>Ver <a href="https://gemini.circumlunar.space/clients.html" target="_blank">gemini.circumlunar.space/clients.html</a></p>
<p><strong>Fuentes</strong>: <a href="https://github.com/mbrubeck/agate" target="_blank">github/mbrubeck</a>, <a href="https://www.ochobitshacenunbyte.com/2021/11/15/como-crear-una-capsula-gemini-en-linux/" target="_blank">ochobitshacenunbyte.com</a></p>
</div><!-- /.entry-content -->
</article>
</section>
<footer class="body" id="extras">
<div class="menu">
<h2>Menú</h2>
<nav>
<ul>
<li>
<strong><a href="/">INICIO</a></strong>
</li>
<li><a href="/p/about">About</a></li>
<li><a href="/mapa">Mapa</a></li>
<li><a href="https://github.com/s-nt-s/s-nt-s.github.io/tree/main" target="_blank">Ver Github</a></li>
<li><a href="https://github.com/s-nt-s/s-nt-s.github.io/tree/main/themes/notmyidea-custom/templates/article.html" target="_blank">Ver Template</a></li>
<li><a href="https://github.com/s-nt-s/s-nt-s.github.io/tree/main/content/posts/2023-02-26_gemini.md" target="_blank">Ver Markdown</a></li>
</ul>
<ul>
<li><a href="https://validator.w3.org/check?charset=(detect+automatically)&amp;doctype=Inline&amp;group=1&amp;uri=https://s-nt-s.github.io/gemini" target="_blank">Validar HTML</a></li>
</ul>
</nav>
</div><!-- /.menu -->
<div class="social">
<h2>Social</h2>
<ul>
<li><a href="/feeds/all.atom.xml" rel="alternate" type="application/atom+xml">atom feed</a></li>
<li><a href="https://github.com/s-nt-s/" target="_blank">@s-nt-s</a></li>
<li><a href="xmpp:git@suchat.org">git@suchat.org</a></li>
</ul>
</div><!-- /.social -->
<div class="license">
<p><a class="logo" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.es" rel="license" target="_blank"><img alt="Licencia Creative Commons" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"/></a> Esta obra está bajo una <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.es" rel="license" target="_blank">Licencia Creative Commons Atribución-NoComercial-CompartirIgual 4.0 Internacional</a>.</p>
</div>
</footer><!-- /#extras -->
</body>
</html>